---
import { Image } from 'astro:assets';
import Logo from '../../Logo.astro';
import yellLogoUrl from '../../../assets/global/Yell-Reviews-Logo.png';

import CloseIcon from '../../../assets/icons/close.svg';
import BoltIcon from '../../../assets/icons/bolt.svg';
import ArrowRightIcon from '../../../assets/icons/arrow-right.svg';
import PhoneIcon from '../../../assets/icons/phone.svg';
import EmailIcon from '../../../assets/icons/email.svg';
import EmergencyIcon from '../../../assets/icons/emergency.svg';
import FacebookIcon from '../../../assets/icons/facebook.svg';
import LinkedinIcon from '../../../assets/icons/linkedin.svg';
import InstagramIcon from '../../../assets/icons/instagram.svg';
---

<div class="mobile-nav" id="mobileNav" aria-hidden="true">
  <div class="full-divider" aria-hidden="true"></div>

  <div class="nav-header">
    <Logo loading="lazy" class="mobile-logo" />

    <button class="close-btn" id="closeMenu" aria-label="Close menu">
      <CloseIcon class="icon icon--lg" />
    </button>
  </div>

  <div class="full-divider" aria-hidden="true"></div>

  <div class="cta">
    <p class="cta-kicker">Need an electrician?</p>
    <h2 class="cta-title">Get a free quote</h2>
    <p class="cta-text">
      Domestic, commercial and renewables. Clear pricing and reliable call-outs.
    </p>

    <button class="cta-btn" data-open-contact-modal data-close-mobile-nav>
      <span class="cta-btn-left">
        <BoltIcon class="icon icon--md" />
        <span>Request a quote</span>
      </span>
      <ArrowRightIcon class="icon icon--md" />
    </button>
  </div>

  <nav class="nav" aria-label="Mobile navigation">
    <ul class="nav-list">
      <li class="nav-item">
        <a class="nav-link" href="/teiv2/home" data-close-mobile-nav>Home</a>
      </li>

      <li class="divider"></li>

      <li class="nav-item">
        <details class="nav-accordion">
          <summary class="nav-summary">
            <span>Services</span>
            <span class="caret" aria-hidden="true">▾</span>
          </summary>

          <div class="nav-sub">
            <a class="nav-sublink" href="/teiv2/services" data-close-mobile-nav>All Services</a>
            <a class="nav-sublink" href="/teiv2/services/commercial" data-close-mobile-nav>Commercial</a>
            <a class="nav-sublink" href="/teiv2/services/renewable" data-close-mobile-nav>Renewable</a>
            <a class="nav-sublink" href="/teiv2/services/domestic" data-close-mobile-nav>Domestic</a>
          </div>
        </details>
      </li>

      <li class="divider"></li>

      <li class="nav-item">
        <a class="nav-link" href="/teiv2/portfolio" data-close-mobile-nav>Portfolio</a>
      </li>

      <li class="divider"></li>

      <li class="nav-item">
        <details class="nav-accordion">
          <summary class="nav-summary">
            <span>About</span>
            <span class="caret" aria-hidden="true">▾</span>
          </summary>

          <div class="nav-sub">
            <a class="nav-sublink" href="/teiv2/about-us" data-close-mobile-nav>About Us</a>
            <a class="nav-sublink" href="/teiv2/about-us/accreditations" data-close-mobile-nav>
              Accreditations &amp; Certifications
            </a>
          </div>
        </details>
      </li>

      <li class="divider"></li>

      <li class="nav-item">
        <a class="nav-link" href="/teiv2/contact" data-close-mobile-nav>Contact</a>
      </li>
    </ul>
  </nav>

  <div class="contact">
    <a href="tel:01723449667" class="contact-item" data-close-mobile-nav>
      <PhoneIcon class="icon icon--md icon--accent" />
      <span>01723 449667</span>
    </a>

    <a href="mailto:info@tei-ltd.co.uk" class="contact-item" data-close-mobile-nav>
      <EmailIcon class="icon icon--md icon--accent" />
      <span>info@tei-ltd.co.uk</span>
    </a>
  </div>

  <div class="full-divider" aria-hidden="true"></div>

  <div class="social">
    <a href="#" class="social-btn" aria-label="Facebook">
      <FacebookIcon class="icon icon--md" />
    </a>
    <a href="#" class="social-btn" aria-label="LinkedIn">
      <LinkedinIcon class="icon icon--md" />
    </a>
    <a href="#" class="social-btn" aria-label="Instagram">
      <InstagramIcon class="icon icon--md" />
    </a>

    <a
      href="https://www.yell.com/biz/them-electrical-installations-ltd-filey-10772044/"
      target="_blank"
      rel="noopener"
      class="yell-btn"
      aria-label="Yell reviews"
    >
      <img src={yellLogoUrl.src} alt="Yell Reviews" class="yell-logo" />
    </a>
  </div>

  <div class="full-divider" aria-hidden="true"></div>
</div>

<style>
/* Panel */
.mobile-nav {
  position: fixed;
  top: 0;
  right: -100%;
  width: min(420px, 86vw);
  height: 100vh;

  /* Solid background */
  background: rgb(30, 30, 30);

  z-index: 1000;
  display: flex;
  flex-direction: column;

  border-left: 2px solid rgba(255, 255, 255, 0.06);
  box-shadow: -10px 0 30px rgba(0, 0, 0, 0.35);

  padding: 1.1rem 1.1rem 2rem;

  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.mobile-nav.active {
  right: 0;
}

/* Icon normalisation */
.icon {
  width: 1.25rem;
  height: 1.25rem;
  display: inline-block;
  flex: 0 0 auto;
}

.icon--md {
  width: 1.4rem;
  height: 1.4rem;
}

.icon--lg {
  width: 1.9rem;
  height: 1.9rem;
}

.icon--accent {
  color: var(--color-accent);
}

/* Green divider with controlled spacing */
.full-divider {
  padding: 0.45rem 0;      /* dark grey space above and below the line */
  margin: 0 -1.1rem;       /* bleed to full width based on container padding */
  background: rgb(30, 30, 30);
}

.full-divider::before {
  content: "";
  display: block;
  height: 3px;
  background: linear-gradient(
    270deg,
    var(--color-accent) 0%,
    var(--color-primary) 50%,
    transparent 100%
  );
}

/* Header */
.nav-header {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  background: rgb(30, 30, 30);
  padding: 0.65rem 0 0.85rem;
}

.mobile-logo {
  height: 3.9rem;
  width: auto;
  display: block;
}

.close-btn {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);

  background: rgba(255, 255, 255, 0.08);
  border: 2px solid rgba(255, 255, 255, 0.15);
  border-radius: 50%;
  padding: 0.45rem;
  cursor: pointer;
  color: var(--color-accent);
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--color-accent);
  transform: translateY(-50%) scale(1.05);
}

.close-btn:active {
  transform: translateY(-50%) scale(0.95);
}

/* CTA */
.cta {
  margin: 0.85rem 0 1.1rem;
  padding: 1.2rem;
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(46, 46, 46, 0.95) 0%, rgba(38, 38, 38, 0.95) 100%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.cta-kicker {
  margin: 0 0 0.25rem;
  color: var(--color-accent);
  font-weight: 800;
  font-size: 0.95rem;
}

.cta-title {
  margin: 0 0 0.35rem;
  color: var(--color-bg);
  font-weight: 900;
  font-size: 1.5rem;
}

.cta-text {
  margin: 0 0 0.9rem;
  color: rgba(255, 255, 255, 0.78);
  line-height: 1.35;
}

.cta-btn {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;

  background: var(--color-accent);
  color: var(--color-contrast);
  text-decoration: none;

  border-radius: 50px;
  padding: 0.95rem 1.2rem;
  font-weight: 900;
  border: 2px solid transparent;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(253, 238, 33, 0.3);
  position: relative;
  overflow: hidden;
}

.cta-btn::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.2);
  transform: translateX(-100%);
  transition: transform 0.3s ease;
}

.cta-btn:active::before {
  transform: translateX(0);
}

.cta-btn:active {
  transform: scale(0.98);
  box-shadow: 0 2px 8px rgba(253, 238, 33, 0.4);
}

.cta-btn-left {
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
}

/* Nav */
.nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.divider {
  height: 1px;
  background: rgba(255, 255, 255, 0.12);
  margin: 0.85rem 0;
}

.nav-link {
  display: block;
  padding: 0.35rem 0;
  color: var(--color-bg);
  text-decoration: none;
  font-size: 1.25rem;
  font-weight: 800;
}

.nav-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.35rem 0;
  color: var(--color-bg);
  font-size: 1.25rem;
  font-weight: 900;
  cursor: pointer;
}

.nav-summary::-webkit-details-marker {
  display: none;
}

.caret {
  color: var(--color-accent);
}

.nav-sub {
  margin-top: 0.6rem;
  padding: 0.75rem 0.85rem;
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(46, 46, 46, 0.95) 0%, rgba(38, 38, 38, 0.95) 100%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.nav-sublink {
  display: block;
  padding: 0.55rem 0;
  color: rgba(255, 255, 255, 0.95);
  text-decoration: none;
  font-size: 1.08rem;
  font-weight: 700;
}

.nav-sublink:not(:last-child) {
  border-bottom: 1px solid rgba(255, 255, 255, 0.10);
}

/* Contact (polished) */
.contact {
  margin-bottom: 1.5rem;
  padding: 0.9rem 0 0.2rem;
  border-radius: 16px;

  background: linear-gradient(135deg, rgba(46, 46, 46, 0.95) 0%, rgba(38, 38, 38, 0.95) 100%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.contact-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;

  text-decoration: none;
  color: var(--color-bg);
  font-weight: 800;
  font-size: 1.05rem;

  padding: 0.75rem 0.85rem;
  border-radius: 12px;
  transition: all 0.3s ease;
}

.contact-item:active {
  background: rgba(255, 255, 255, 0.05);
  transform: translateX(4px);
}

.contact-item + .contact-item {
  margin-top: 0.35rem;
}

.contact-item:not(:last-of-type) {
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.contact-item .icon {
  color: var(--color-accent);
  width: 1.35rem;
  height: 1.35rem;
  flex: 0 0 auto;
  opacity: 0.95;
}

.contact-item span {
  display: block;
  line-height: 1.15;
}

/* Social (polished) */
.social {
  display: flex;
  gap: 0.85rem;
  align-items: center;

  padding: 0.85rem 0.2rem 0.45rem;
}

.social-btn {
  width: 3.1rem;
  height: 3.1rem;
  border-radius: 12px;

  display: flex;
  align-items: center;
  justify-content: center;

  background: var(--color-accent);
  border: 2px solid var(--color-accent);

  color: #1e1e1e;
  text-decoration: none;
  transition: all 0.3s ease;
}

.social-btn:active {
  background: #e8d01e;
  border-color: var(--color-accent);
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 4px 12px rgba(253, 238, 33, 0.4);
}

.social-btn .icon {
  width: 1.4rem;
  height: 1.4rem;
}

.yell-btn {
  flex: 1;
  min-height: 3.1rem;
  border-radius: 6px;

  background: var(--color-bg);
  border: none;

  padding: 0;

  display: flex;
  align-items: center;
  justify-content: center;

  text-decoration: none;
  transition: all 0.3s ease;
}

.yell-btn:active {
  border-color: var(--color-accent);
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 4px 12px rgba(42, 145, 52, 0.4);
}

.yell-logo {
  height: 100%;
  width: 100%;
  max-height: 3.1rem;
  object-fit: contain;
  background: var(--color-bg);
  padding: 0.1rem;
  display: block;
  border-radius: 6px;
  border-left: solid 0.75rem #fdee21;
  border-right: solid 0.75rem #fdee21;
}
</style>

<script>
  const mobileNav = document.getElementById('mobileNav');
  const closeMenuBtn = document.getElementById('closeMenu');

  const closeMobileNav = () => {
    mobileNav?.classList.remove('active');
    document.body.style.overflow = 'auto';
    mobileNav?.setAttribute('aria-hidden', 'true');
  };

  closeMenuBtn?.addEventListener('click', closeMobileNav);

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileNav?.classList.contains('active')) {
      closeMobileNav();
    }
  });

  mobileNav?.addEventListener('click', (e) => {
    const target = e.target;
    if (target instanceof HTMLElement && target.closest('[data-close-mobile-nav]')) {
      closeMobileNav();
    }
  });

  const accordions = document.querySelectorAll<HTMLDetailsElement>('.nav-accordion');
  accordions.forEach((acc) => {
    acc.addEventListener('toggle', () => {
      if (acc.open) {
        accordions.forEach((other) => {
          if (other !== acc) other.removeAttribute('open');
        });
      }
    });
  });
</script>
