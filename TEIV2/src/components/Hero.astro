---
import { Image } from 'astro:assets';
import Section from './Section.astro';

import slide1 from '../assets/hero-carousel/slide1.jpg';
import slide2 from '../assets/hero-carousel/slide2.jpg';
import slide3 from '../assets/hero-carousel/slide3.jpg';

const slides = [
  {
    image: slide1,
    alt: 'Solar Panel Installation',
    text: 'Solar Panel & Battery Storage Solutions',
    subtext: 'Reduce bills, store energy, and make the most of your solar generation.',
    buttonText: 'Learn More',
    buttonLink: '/services/solar',
  },
  {
    image: slide2,
    alt: 'EV Charging Point',
    text: 'EV Charging Point Installations',
    subtext: 'Home and business charging points installed safely and professionally.',
    buttonText: 'View Services',
    buttonLink: '/services/ev-charging',
  },
  {
    image: slide3,
    alt: 'Electrical Maintenance',
    text: '24 Hour Emergency Callout',
    subtext: 'Fast response when you need it most, day or night.',
    buttonText: 'Emergency Service',
    buttonLink: '/emergency',
  },
];
---

<Section lightningPathcolour="fff">
  <div class="carousel-container">
    <div class="hero-swiper swiper">
      <div class="swiper-wrapper">
        {
          slides.map((slide) => (
            <div class="swiper-slide">
              <Image
                src={slide.image}
                alt={slide.alt}
                class="slide-image"
                loading="eager"
                decoding="async"
              />

              <div class="carousel-caption">
                <h2>{slide.text}</h2>
                <p class="carousel-subtext">{slide.subtext}</p>
                <a href={slide.buttonLink} class="slide-btn">{slide.buttonText}</a>
              </div>
            </div>
          ))
        }
      </div>

      <div class="swiper-pagination"></div>
      <div class="swiper-button swiper-button-prev" aria-label="Previous slide"></div>
      <div class="swiper-button swiper-button-next" aria-label="Next slide"></div>
    </div>
  </div>
</Section>

<style>
  .carousel-container {
    position: relative;
    width: 100%;
    height: calc(100vh - 60px);
    max-height: 520px;
    overflow: hidden;
  }

  .hero-swiper {
    width: 100%;
    height: 100%;
  }

  .swiper-slide {
    position: relative;
    height: 100%;
  }

  .slide-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Controls */
  .hero-swiper :global(.swiper-button-prev),
  .hero-swiper :global(.swiper-button-next),
  .hero-swiper :global(.swiper-pagination) {
    z-index: 5;
  }

  .hero-swiper :global(.swiper-button-prev),
  .hero-swiper :global(.swiper-button-next) {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    color: #fdee21;
    background: rgba(0, 0, 0, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.18);
    backdrop-filter: blur(4px);
    top: 65%;
    transform: translateY(-50%);
  }

/* If you are using Swiperâ€™s navigation SVG icons */
.hero-swiper :global(.swiper-button-next .swiper-navigation-icon),
.hero-swiper :global(.swiper-button-prev .swiper-navigation-icon) {
  width: 18px;
  height: 18px;
  fill: #fdee21;
}

/* Fallback for default Swiper arrows (pseudo-element) */
.hero-swiper :global(.swiper-button-next)::after,
.hero-swiper :global(.swiper-button-prev)::after {
  font-size: 18px;
  color: #fdee21;
}

  .hero-swiper :global(.swiper-pagination) {
    left: 50%;
    transform: translateX(-50%);
    bottom: 9% !important;

    display: flex;
    align-items: center;
    Width : auto;

    padding: 0.35rem 0.5rem;
    border-radius: 12px;

    background: rgba(0, 0, 0, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.18);
    backdrop-filter: blur(4px);
  }

  .hero-swiper :global(.swiper-pagination-bullet) {
    width: 9px;
    height: 9px;
    border-radius: 3px;

    opacity: 1;
    background: rgba(255, 255, 255, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.25);
  }

  .hero-swiper :global(.swiper-pagination-bullet-active) {
    background: #fdee21;
    border-color: rgba(0, 0, 0, 0.25);
  }

  /* Caption */
  .carousel-caption {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 25%;

    background: linear-gradient(
      to bottom,
      rgba(64, 130, 32, 0.85),
      rgba(48, 102, 24, 0.95)
    );

    padding: 1.05rem 2rem;
    border-radius: 8px;
    min-width: 320px;
    max-width: 90%;
    text-align: center;

    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .carousel-caption h2 {
    margin: 0 0 0.45rem;
    font-size: 1.8rem;
    font-weight: 700;
    color: #fdee21;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .carousel-subtext {
    margin: 0 0 0.85rem;
    font-size: 1.02rem;
    line-height: 1.35;
    color: rgba(255, 255, 255, 0.92);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.28);
  }

  .slide-btn {
    display: inline-block;
    background: #fdee21;
    color: #616060;
    padding: 0.7rem 1.6rem;
    border-radius: 6px;
    font-weight: 700;
    text-decoration: none;
    font-size: 1.02rem;
  }

  @media (max-width: 768px) {
    .carousel-container {
      max-height: 500px;
    }

    .carousel-caption {
      top: 35%;
      bottom: auto;
      padding: 0.9rem 1.4rem;
      min-width: 260px;
    }

    .carousel-caption h2 {
      font-size: 1.4rem;
    }

    .carousel-subtext {
      font-size: 0.95rem;
    }

    .hero-swiper :global(.swiper-button-prev),
    .hero-swiper :global(.swiper-button-next) {
      width: 34px;
      height: 34px;
    }

    .hero-swiper :global(.swiper-pagination-bullet) {
      width: 8px;
      height: 8px;
    }
  }

  @media (max-width: 480px) {
    .carousel-caption {
      bottom: 25%;
      top: auto;
      padding: 0.85rem 1rem;
  
    }

    .carousel-caption h2 {
      font-size: 1.2rem;
    }

    .carousel-subtext {
      font-size: 0.9rem;
    }

    .slide-btn {
      font-size: 0.9rem;
      padding: 0.45rem 1.1rem;
    }

    .hero-swiper :global(.swiper-button-prev),
    .hero-swiper :global(.swiper-button-next) {
      width: 32px;
      height: 32px;
    }

    .hero-swiper :global(.swiper-pagination) {
      bottom: 7% !important;
      padding: 0.3rem 0.45rem;
    }
  }

  
</style>

<script>
  import Swiper from 'swiper';
  import { Navigation, Pagination, Autoplay } from 'swiper/modules';
  import 'swiper/css/bundle';

  const initHeroSwiper = () => {
    const root = document.querySelector('.hero-swiper');
    if (!(root instanceof HTMLElement)) return;

    if (root.dataset.swiperInit === 'true') return;
    root.dataset.swiperInit = 'true';

    const paginationEl = root.querySelector('.swiper-pagination');
    const nextEl = root.querySelector('.swiper-button-next');
    const prevEl = root.querySelector('.swiper-button-prev');

    if (!(paginationEl instanceof HTMLElement)) return;
    if (!(nextEl instanceof HTMLElement)) return;
    if (!(prevEl instanceof HTMLElement)) return;

    new Swiper(root, {
      modules: [Navigation, Pagination, Autoplay],
      loop: true,
      autoplay: { delay: 5000, disableOnInteraction: false },
      pagination: { el: paginationEl, clickable: true },
      navigation: { nextEl, prevEl },
    });
  };

  document.addEventListener('DOMContentLoaded', initHeroSwiper);
  document.addEventListener('astro:page-load', initHeroSwiper);
</script>
